<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord - Gestion Aéroport</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="terminal">
    <div id="output"></div>
    
    <div id="menu-container">
        <h3 id="menu-title"></h3>
        <div id="menu-options"></div>
        <br>
        <button id="logoutButton">Logout</button>
    </div>
</div>

<script>
    const outputDiv = document.getElementById('output');
    const menuContainer = document.getElementById('menu-container');
    const logoutButton = document.getElementById('logoutButton');
    const menuTitle = document.getElementById('menu-title');
    const menuOptions = document.getElementById('menu-options');

    let loggedInUser = null;

    // Check for logged in user on page load
    document.addEventListener('DOMContentLoaded', () => {
        const userJson = sessionStorage.getItem('loggedInUser');
        if (!userJson) {
            window.location.href = 'login.html';
            return;
        }
        loggedInUser = JSON.parse(userJson);
        showMenu();
    });

    function showMenu() {
        menuTitle.innerText = `Welcome, ${loggedInUser.name} (level: ${loggedInUser.type})`;

        let optionsHtml = '';

        // Add Creneau management/reservation button
        if (loggedInUser.type === 'gestionnaire') {
            optionsHtml += '<button class="creneau-access-button" data-creneau-page="manage_creneaux.html">Gérer les Créneaux</button><br><br>';
        } else if (loggedInUser.type === 'agent') {
            optionsHtml += '<button class="creneau-access-button" data-creneau-page="agent_dashboard.html">Voir les Créneaux</button><br><br>';
        } else if (loggedInUser.type === 'pilote') {
            optionsHtml += '<button class="creneau-access-button" data-creneau-page="reserve_creneau.html">Réserver un Créneau</button><br><br>';
        }
        
        // Existing account creation options
        if (loggedInUser.type === 'gestionnaire') {
            optionsHtml += '<p>Options de création :</p>';
            optionsHtml += '<button data-action="create-gestionnaire">Créer un compte Gestionnaire</button><br><br>';
            optionsHtml += '<button data-action="create-agent">Créer un compte Agent</button><br><br>';
            optionsHtml += '<button data-action="create-pilote">Créer un compte Pilote</button>';
        } else if (loggedInUser.type === 'agent') {
            optionsHtml += '<p>Options de création :</p>';
            optionsHtml += '<button data-action="create-pilote">Créer un compte Pilote</button>';
        } else {
            // This 'else' block will now only be for general messages, if creneau button not added above
            // optionsHtml += '<p>Aucune action de création de compte disponible.</p>';
        }
        menuOptions.innerHTML = optionsHtml;
    }

    logoutButton.addEventListener('click', () => {
        sessionStorage.removeItem('loggedInUser');
        window.location.href = 'login.html';
    });

    menuOptions.addEventListener('click', function(event) {
        if (event.target.tagName === 'BUTTON') {
            if (event.target.classList.contains('creneau-access-button')) {
                const page = event.target.getAttribute('data-creneau-page');
                if (page) {
                    window.location.href = page;
                }
            } else if (event.target.getAttribute('data-action') && event.target.getAttribute('data-action').startsWith('create-')) {
                const action = event.target.getAttribute('data-action');
                const userType = action.split('-')[1];
                window.location.href = `create_user.html?type=${userType}`;
            }
        }
    });
</script>

</body>
</html>
